<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.ham.main.partner.PartnerDAO">
  	
  	<!-- 로그인 -->
    <select id="getPartnerLong" parameterType="PartnerDTO" resultMap="getPartnerLoginResult">
    	SELECT P.*, R.* 
			FROM PARTNER P 
			INNER JOIN MEMBERROLE MR
			ON(P.ID = MR.ID)
			INNER JOIN ROLE R
			ON(MR.ROLENUM = R.ROLENUM)
			WHERE P.ID = #{id}
    </select>
    
    <resultMap type="PartnerDTO" id="getPartnerLoginResult">
  		<!-- column의 이름과 setter의 이름이 같아야함. -->
  		<id column="ID" property="id"/>
  		<result column="PARTNERNUM" property="partnerNum"/>
  		<result column="PARTNEREMAIL" property="partnerEmail"/>
  		<result column="PARTNEREMAILDOMAIN" property="partnerEmailDomain"/> 
  		<result column="PARTNERADDRESS" property="partnerAddress"/>
  		<result column="PARTNERACCOUNT" property="partnerAccount"/>
  		<result column="PARTNERDATE" property="partnerDate"/>
  		<result column="PARTNERNAME" property="partnerName"/>

  		<collection property="roles" javaType="List" ofType="RoleDTO">
			<id column="ROLENUM" property="roleNum"/>
			<result column="ROLENAME" property="roleName"/>
		</collection>
  	</resultMap>
  	
  	<insert id="setMemberRole" parameterType="PartnerDTO">
  		INSERT INTO MEMBERROLE (ID, ROLENUM) 
  			VALUES (#{id}, (SELECT ROLENUM FROM ROLE WHERE ROLENAME='PARTNER'))
  	</insert>
    
    <!-- 공간등록 -->
    <insert id="setPartnerJoin" parameterType="PartnerDTO">
    	INSERT INTO 
    		PARTNER(PARTNERNUM, ID, PARTNEREMAIL, PARTNEREMAILDOMAIN, PARTNERADDRESS, PARTNERACCOUNT, PARTNERDATE, PARTNERNAME)
    			VALUES(PARTNER_SEQ.NEXTVAL, #{id}, #{partnerEmail}, #{partnerEmailDomain}, #{partnerAddress}, #{partnerAccount}, SYSDATE, #{partnerName})
    </insert>
  </mapper>
  