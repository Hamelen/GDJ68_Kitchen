<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.ham.main.review.ReviewDAO">

  <sql id="myReviewList">
  SELECT 
  REVIEWNUM, PRODUCTNUM, ID, REVIEWRATE, REVIEWCONTENTS, REVIEWDATE
  FROM REVIEW ORDER BY REVIEWNUM
  	
  </sql>


  	<select id="getTotal" resultType="Long">
		SELECT COUNT(REVIEWNUM) 
		FROM REVIEW
	</select>
  <!-- 게시물 목록 -->
<select id="list" resultType="ReviewDTO">
  SELECT *
		FROM (SELECT ROWNUM R, N.*
			  FROM (SELECT * 
			  		FROM REVIEW 
			  		ORDER BY REVIEWNUM DESC) N)
		WHERE R BETWEEN #{startRow} AND #{lastRow}
</select>

<select id="myList">
	<include refid="myReviewList"></include>
	WHERE ID = #{id}
</select>

<!-- 게시물 작성 -->
<insert id="add" parameterType="ReviewDTO">
 INSERT INTO REVIEW
  VALUES(review_seq.nextval,#{productNum},#{id}, #{reviewRate},#{reviewContents},SYSDATE)
</insert>
  <!-- 게시물 조회 -->
<select id="view" parameterType="Long" resultType="ReviewDTO">
 SELECT REVIEWNUM, PRODUCTNUM, ID, REVIEWRATE, REVIEWCONTENTS, REVIEWDATE
   FROM REVIEW
  WHERE REVIEWNUM=#{reviewNum}
</select>
<!-- 게시물 수정 -->
<update id="update" parameterType="ReviewDTO" >
 UPDATE REVIEW
    SET ID = #{id}, REVIEWRATE=#{reviewRate}, REVIEWCONTENTS=#{reviewContents},
    REVIEWDATE=SYSDATE
  WHERE REVIEWNUM = #{reviewNum}
</update>
<!-- 게시물 삭제 -->
<delete id="delete" parameterType="long">
 DELETE
   FROM REVIEW
  WHERE REVIEWNUM = #{reviewNum}
</delete>

<select id="getFileDetail" parameterType="ReviewFileDTO" resultType="ReviewFileDTO">
		SELECT FILENUM, FILENAME 
		FROM REVIEWFILE
		WHERE FILENUM = #{fileNum} 
	</select>
	
	<insert id="setFileAdd" parameterType="ReviewFileDTO">
		INSERT INTO REVIEWFILE(FILENUM, REVIEWNUM, FILENAME, ORIGINALNAME)
		VALUES(FILE_SEQ.NEXTVAL, #{reviewNum}, #{fileName}, #{originalName})
	</insert>

	<delete id="setFileDelete" parameterType="ReviewFileDTO">
		DELETE REVIEWFILE
		WHERE FILENUM = #{fileNum}
	</delete>
  </mapper>